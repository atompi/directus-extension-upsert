"use strict";const e={success:!0,msg:"Success",code:200,data:null};var s={id:"upsert",handler:async(s,{services:c,database:t,getSchema:a,exceptions:n})=>{const{ItemsService:o}=c,{ServiceUnavailableException:i,RouteNotFoundException:r}=n;s.post("/:collection",(async(s,c,t)=>{try{const{collection:a}=s.params;if(!a)return t(new r);let n=s.body||{};const{filter:i={},body:l={}}=n;if(!i||!Object.keys(i).length)return c.json({...e,success:!1,msg:"Missing filter"});const u=new o(a,{schema:s.schema,accountability:s.accountability}),m=u.schema.collections[a].primary,d={...i},p=await u.knex.select(m).from(a).where(d).first();p?(await u.updateOne(p[m],l),c.json({...e,msg:"Update Success"})):(await u.createOne(l),c.json({...e,msg:"Create Success",code:201}))}catch(e){return t(new i(e.message))}}))}};module.exports=s;
